---
import * as Icon from "@astropub/icons";
import Container from "../components/Container.astro";
import { Client } from "@notionhq/client";

import type { QueryDatabaseResponse } from "@notionhq/client/build/src/api-endpoints";

// Initializing a client
const notion = new Client({
  auth: import.meta.env.NOTION_TOKEN,
});

const projects: QueryDatabaseResponse = await notion.databases.query({
  database_id: "c4180f9f1b6449f79d0a84645d92879c",
  sorts: [
    {
      property: "Name",
      direction: "ascending",
    },
  ],
});

type Project = {
  Category: string;
  "Start date": string;
  Logo: string;
  Name: string;
  Description: string;
  ChannelURL: string;
};

const project_items = projects.results
  .map((project: any) => {
    return {
      category: project.properties.Category.select?.name,
      start_date: project.properties["Start date"].date?.start,
      logo: project.properties.Logo.files[0]?.name,
      name: project.properties.Name.title[0]?.plain_text,
      description: project.properties.Description.rich_text[0]?.plain_text,
      discord_channel_url: project.properties.ChannelURL.url,
      website_url: project.properties.WebsiteURL.url,
      github_url: project.properties.Github.url,
    };
  })
  .filter(
    (project) =>
      project.name && project.description && project.discord_channel_url,
  );

// const data = [
//   {
//     img: "https://avatars.githubusercontent.com/u/151086389?s=200&v=4",
//     label: "Palestine Badge",
//     website: null,
//     description:
//       "Show solidarity with Palestine and add a badge to your code repository",
//     github: "https://github.com/TechForPalestine/badges",
//   },
//   {
//     img: "https://avatars.githubusercontent.com/u/151086389?s=200&v=4",
//     label: "Palestine Banner",
//     website: null,
//     description: "Add a #CeasefireNOW banner to your website",
//     github: "https://github.com/TechForPalestine/palestine-banner",
//   },
//   {
//     img: "https://avatars.githubusercontent.com/u/151086389?s=200&v=4",
//     label: "Palestine Datasets",
//     website: "https://data.techforpalestine.org",
//     description:
//       "Open source datasets showing the human toll on Palestinians of Israel's attacks since Oct 7",
//     github: "https://github.com/TechForPalestine/palestine-numbers",
//   },
//   {
//     img: "https://avatars.githubusercontent.com/u/151086389?s=200&v=4",
//     label: "Palestine Profile Pic Maker",
//     website: "https://ppm.techforpalestine.org",
//     description: "Add a ðŸ‡µðŸ‡¸ themed border to your profile images",
//     github: "https://github.com/TechForPalestine/palestine-pfp-maker",
//   },
//   {
//     img: "https://avatars.githubusercontent.com/u/151086389?s=200&v=4",
//     label: "Anti-Palestinian VC Funds",
//     website: null,
//     description:
//       "A list of VCs that support Israel's genocide against the Palestinian people of Gaza",
//     github: "https://github.com/TechForPalestine/antipalestinian-vc-funds",
//   },
//   {
//     img: "https://avatars.githubusercontent.com/u/151086389?s=200&v=4",
//     label: "Israeli Tech Alternatives",
//     website: "https://israelitechalternatives.com/",
//     description:
//       "A comprehensive list of Israeli tech companies to boycott and suggested alternatives",
//     github:
//       "https://github.com/TechForPalestine/boycott-israeli-tech-companies-dataset",
//   },
// ];
---

<section class="py-24 bg-white" id="projects-list">
  <Container>
    <div class="space-y-8">
      <div class="text-center space-y-2">
        <h2 class="font-medium text-4xl">Browse our projects</h2>
      </div>
      <div
        class="divide-y divide-solid border rounded-md overflow-hidden bg-white shadow-sm"
      >
        {
          project_items.map(
            ({
              name,
              description,
              github_url,
              logo,
              website_url,
              discord_channel_url,
            }) => (
              <div class="flex gap-4 justify-between items-center text-zinc-900 p-4 hover:bg-zinc-50">
                <div class="flex-grow flex gap-4 items-center">
                  <img
                    src={
                      "https://avatars.githubusercontent.com/u/151086389?s=200&v=4"
                    }
                    class="w-10 h-10 rounded-lg"
                  />
                  <div>
                    <h3 class="font-semibold">{name}</h3>
                    <p class="text-ellipsis overflow-hidden text-sm text-zinc-600">
                      {description.length > 120
                        ? description.slice(0, 120) + "..."
                        : description}
                    </p>
                  </div>
                </div>
                <div class="flex flex-col md:flex-row">
                  {website_url && (
                    <a
                      class="flex justify-between items-center text-zinc-900 p-4 hover:bg-zinc-50"
                      href={website_url}
                      target="_blank"
                    >
                      <Icon.Globe class="w-6 h-6" />
                    </a>
                  )}
                  {github_url && (
                    <a
                      class="flex justify-between items-center text-zinc-900 p-4 hover:bg-zinc-50"
                      href={github_url}
                      target="_blank"
                    >
                      <Icon.GitHubLogo class="w-6 h-6" />
                    </a>
                  )}
                  {discord_channel_url && (
                    <a
                      class="flex justify-between items-center text-zinc-900 p-4 hover:bg-zinc-50"
                      href={discord_channel_url}
                      target="_blank"
                    >
                      <img class="h-6" src="/public/discord.png" />
                    </a>
                  )}
                </div>
              </div>
            ),
          )
        }
      </div>
    </div>
  </Container>
</section>
